/*! zold 2018-06-13 */

function init(){refresh("b2.zold.io:4096",new google.maps.Map(document.getElementById("map"),{center:new google.maps.LatLng(55.751244,37.618423),mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:3}))}function refresh(e,o){$.getJSON("http://"+e+"/",function(t){$("#header").html("Version: "+t.version+"<br/>Host: "+t.score.host+":"+t.score.port+"<br/>Score: "+t.score.value+"<br/>Remote nodes: "+t.remotes+"<br/>Wallets: "+t.wallets),refresh_list(e,o),window.setTimeout(function(){refresh(e,o)},1e4)})}function refresh_list(o,n){$.getJSON("http://"+o+"/remotes",function(t){var e=t.all;console.log(e.length+" remote nodes found at "+o),put_markers(n,e)})}function put_markers(l,t){$.each(t,function(t,e){var o=e.host,n=e.port,r=o+":"+n,a=$('#remotes-table tr[data-coords="'+r+'"]');if(a.length){var s=a.first();$.getJSON("http://"+r+"/",function(t){s.html("<td>"+r+"</td><td>"+t.score.value+"</td><td>"+t.wallets+"</td><td>"+t.version+"</td>"),o.match(/^[0-9\.]+$/)?put_marker_by_ip(l,o+":"+n,o,n):put_marker_by_host(l,o+":"+n,o,n)}).done(function(){s.css("color","darkgreen")}).fail(function(){s.css("color","red")})}else $("#remotes-table").append('<tr data-coords="'+r+'"><td>'+r+"</td> <td colspan=3>&nbsp;</td> </tr>")})}function put_marker_by_host(e,o,n,r){$.getJSON("https://api.exana.io/dns/"+n+"/a",function(t){ip=$.grep(t.answer,function(t,e){return"A"==t.type})[0].rdata,console.log("Host "+n+" resolved to "+ip),put_marker_by_ip(e,o,ip,r)}).fail(function(){console.log("Failed to find IP for "+n)})}function put_marker_by_ip(n,r,a,t){$.getJSON("http://www.geoplugin.net/json.gp?ip="+a,function(t){var e=parseFloat(t.geoplugin_latitude),o=parseFloat(t.geoplugin_longitude);console.log(a+" located at "+e+"/"+o),new google.maps.Marker({position:{lat:e,lng:o},map:n,title:r}),console.log("Marker set for "+r+" at "+e+"/"+o)}).fail(function(){console.log("Failed to find geo-location for "+a)})}