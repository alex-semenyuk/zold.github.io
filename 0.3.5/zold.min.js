/*! zold 2018-06-25 */

function init(){startLoader(),refresh("b2.zold.io:4096",new google.maps.Map(document.getElementById("map"),{center:new google.maps.LatLng(55.751244,37.618423),mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:2}))}function startLoader(){$("#header").html("Loading..."),$("#remotes-table").append('<tr rel="loader"><td colspan="4">Loading...</td></tr>')}function refresh(t,o){$.getJSON("http://"+t+"/",function(e){$('#remotes-table tr[rel="loader"]').hide(),$("#header").html("Version: "+e.version+"<br/>Host: "+e.score.host+":"+e.score.port+"<br/>Score: "+e.score.value+"<br/>Remote nodes: "+e.remotes+"<br/>Wallets: "+e.wallets),refresh_list(t,o),window.setTimeout(function(){refresh(t,o)},1e4)})}function refresh_list(o,n){$.getJSON("http://"+o+"/remotes",function(e){var t=e.all;console.log(t.length+" remote nodes found at "+o),put_markers(n,t)})}function put_markers(l,e){$.each(e,function(e,t){var o=t.host,n=t.port,a=o+":"+n,r=$('#remotes-table tr[data-coords="'+a+'"]');if(r.length){var s=r.first();$.getJSON("http://"+a+"/",function(e){s.html("<td>"+makeALink(a)+"</td><td>"+e.score.value+"</td><td>"+e.wallets+"</td><td>"+e.version+"</td>"),s.addClass("blink"),setTimeout(function(e){e.removeClass("blink")},3e3,s),o.match(/^[0-9\.]+$/)?put_marker_by_ip(l,o+":"+n,o,n):put_marker_by_host(l,o+":"+n,o,n)}).done(function(){s.removeClass("node-down"),s.addClass("node-up")}).fail(function(){s.removeClass("node-up"),s.addClass("node-down")})}else $("#remotes-table").append('<tr data-coords="'+a+'"><td>'+makeALink(a)+"</td> <td colspan=3>&nbsp;</td> </tr>")})}function makeALink(e){return'<a href="http://'+e+'/">'+e+"</a>"}function put_marker_by_host(t,o,n,a){$.getJSON("https://api.exana.io/dns/"+n+"/a",function(e){ip=$.grep(e.answer,function(e,t){return"A"==e.type})[0].rdata,console.log("Host "+n+" resolved to "+ip),put_marker_by_ip(t,o,ip,a)}).fail(function(){console.log("Failed to find IP for "+n)})}function put_marker_by_ip(n,a,r,e){$.getJSON("http://www.geoplugin.net/json.gp?ip="+r,function(e){var t=parseFloat(e.geoplugin_latitude),o=parseFloat(e.geoplugin_longitude);console.log(r+" located at "+t+"/"+o),new google.maps.Marker({position:{lat:t,lng:o},map:n,title:a}),console.log("Marker set for "+a+" at "+t+"/"+o)}).fail(function(){console.log("Failed to find geo-location for "+r)})}